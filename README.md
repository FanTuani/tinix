# Tinix

一个用户态的操作系统核心机制模拟器，用于演示和验证进程管理、内存管理、文件系统和设备管理的关键机制。

## 项目简介

Tinix 是一个教学导向的操作系统模拟项目，采用 C++ 实现，通过离散事件驱动模型和指令流架构，模拟操作系统的核心功能模块。项目注重**机制推演**而非工程完整性，提供可观测、可交互的系统运行过程。

## 特性

- 🔄 **进程管理** - 时间片轮转调度、进程状态机、阻塞/唤醒机制
- 💾 **内存管理** - 分页机制、页面置换算法（FIFO/Clock）、缺页处理
- 📁 **文件系统** - 基于 inode 的文件系统、目录管理、持久化存储
- 🔌 **设备管理** - 设备抽象、资源分配、阻塞队列
- 📝 **指令流架构** - 进程通过 .pc 脚本文件定义行为
- 🖥️ **交互式 Shell** - 命令行界面观察和控制系统状态

## 快速开始

快速编译并运行：

```bash
./bdrun.sh
```

或手动编译：

```bash
mkdir -p build && cd build
cmake ..
make
```

### 示例命令

```bash
# 创建进程
create 10                  # 创建纯计算进程（10条指令）
create -f test1.pc         # 从脚本文件创建进程

# 查看进程状态
ps

# 执行时钟滴答
tick                       # 执行1个tick
tick 10                    # 执行10个tick

# 进程控制
run <pid>                  # 手动调度进程
block <pid> 5              # 阻塞进程5个tick
kill <pid>                 # 终止进程

# 执行脚本
exe script.tsh             # 批量执行命令

# 退出
exit
```

## .pc 脚本格式

进程可通过 `.pc` 脚本文件定义指令序列：

```
# 注释
C                    # Compute - 计算
R <addr>             # MemRead - 读内存
W <addr>             # MemWrite - 写内存
S <duration>         # Sleep - 睡眠
FO <filename>        # FileOpen - 打开文件
FC <fd>              # FileClose - 关闭文件
FR <fd> <size>       # FileRead - 读文件
FW <fd> <size>       # FileWrite - 写文件
DR <dev_id>          # DevRequest - 请求设备
DD <dev_id>          # DevRelease - 释放设备
```

示例文件：`test1.pc`
```
C
C
R 0
R 4096
W 8192
S 3
C
```

## 项目结构

```
tinix/
├── include/          # 头文件
│   ├── proc/        # 进程管理
│   ├── mem/         # 内存管理
│   ├── fs/          # 文件系统
│   ├── dev/         # 设备管理
│   └── shell/       # 交互Shell
├── src/             # 源代码
├── docs/            # 文档
├── *.pc             # 进程脚本示例
└── *.tsh            # Shell脚本示例
```

## 开发进度

- [x] **进程管理基础**
  - [x] PCB 数据结构
  - [x] 五态进程模型（New/Ready/Running/Blocked/Terminated）
  - [x] 时间片轮转调度（Round-Robin）
  - [x] 阻塞与唤醒机制
  - [x] 进程创建与终止

- [x] **指令流架构**
  - [x] 指令类型定义（10种操作）
  - [x] Program 类封装
  - [x] .pc 脚本文件解析
  - [x] 指令执行框架
  - [x] 进程-指令绑定

- [x] **交互式 Shell**
  - [x] 命令解析器
  - [x] 进程控制命令
  - [x] 脚本执行（.tsh）
  - [x] 状态查看命令

- [ ] **内存管理**
  - [x] 物理内存管理器
  - [x] 页表结构
  - [x] 地址转换机制
  - [x] Clock 页面置换算法
  - [ ] Swap 后备存储
  - [x] 缺页统计
  - [x] 进程-内存集成

- [ ] **文件系统**
  - [ ] Superblock 结构
  - [ ] Inode 管理
  - [ ] 目录结构
  - [ ] 文件操作接口
  - [ ] 位图管理
  - [ ] 持久化存储

- [ ] **设备管理**
  - [ ] 设备抽象
  - [ ] 设备分配机制
  - [ ] 阻塞队列
  - [ ] 设备释放

## 技术特点

- **离散事件驱动** - 通过 tick 推进系统时间
- **指令流设计** - 进程行为通过指令序列定义
- **状态可观测** - 所有关键操作输出日志
- **模块化架构** - 各功能模块职责清晰

## 构建要求

- C++20 或更高版本
- CMake 3.20+

## 许可证

本项目基于 GNU General Public License v3.0 开源发布。
详见 LICENSE 文件。

## 相关文档

详细的设计要求和实现细节请参考 [docs/项目要求.md](docs/项目要求.md)
