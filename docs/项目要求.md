# Tinix：项目要求与设计概览

> 本文用于描述 Tinix 的目标定位、设计原则与模块要求，并补充当前仓库实现的对照说明与已知边界。
> 如需快速上手与命令示例，请优先阅读 `README.md`。

## 一、项目目标与定位

本项目在用户态环境下，采用 C++ 语言，通过数据结构与状态机方式，  
模拟操作系统在 **进程管理、内存管理、文件管理与设备管理** 中的关键机制。

项目目标在于构建一个**可推演、可验证的操作系统模型**，  
不以工程完整性或真实内核实现为目标。

### 非目标（Non-goals）

- 不实现真实内核态、硬件中断与真实并发（以单线程“逻辑并发/离散事件”推演为主）。
- 不以性能、吞吐与系统调用兼容性为目标。

---

## 二、总体技术原则

- 实现重点放在 **机制推演**，而非工程细节
- 所有并发均为 **逻辑并发**（单线程驱动）
- 所有资源均通过 **抽象数据结构** 表示

---

## 三、系统实现环境

- 编程语言：C++
- 构建系统：CMake
- 运行平台：macOS / Linux
- 系统模型：离散事件驱动
- 交互方式：命令行 Shell
- （可选）测试：Python 3 + CTest

---

## 四、功能模块与技术要求

---

## （一）进程管理模拟

### 实现内容

1. **进程控制块（PCB）**
   - PID
   - 进程状态
   - 调度相关字段

2. **进程状态机**
   - New / Ready / Running / Blocked / Terminated
   - 明确状态转换触发条件

3. **进程创建与撤销**
   - 创建后进入就绪队列
   - 终止时释放资源

4. **进程调度**
   - 实现时间片轮转（Round-Robin）
   - 调度过程可观测（日志或状态输出）

5. **阻塞与唤醒机制**
   - sleep 阻塞
   - I/O 或设备请求阻塞
   - 条件满足后唤醒并重新调度

---

## （二）内存管理模拟

### 实现内容

1. **分页内存模型**
   - 虚拟内存按固定大小页面划分
   - 物理内存由若干页框组成
   - 使用位图或等价结构管理页框

2. **页表管理**
   - 每进程维护单级页表
   - 页表项包含：
     - present
     - frame number
     - dirty
     - referenced

3. **地址转换与缺页处理**
   - 虚拟地址拆分为页号与页内偏移
   - 访问未驻留页面触发缺页处理流程

4. **页面置换机制**
   - 实现 CLOCK 置换算法
   - 置换过程可完整推演

5. **后备存储模拟**
   - 使用块设备后端模拟 swap 区
   - 支持页面换入与换出

6. **统计与分析**
   - 每进程缺页次数
   - 系统级换入、换出次数
   - 物理页框利用率
   - 支持给定访问序列的缺页统计

---

## （三）文件管理模拟

### 实现内容

1. **inode 文件系统模型**
   - 使用 disk.img 模拟外存
   - 固定大小数据块
   - 文件系统包含：
     - superblock
     - inode bitmap
     - data block bitmap
     - inode table
     - data blocks

2. **inode 结构**
   - 文件类型（普通文件 / 目录）
   - 文件大小
   - 直接数据块指针（仅直接块）

3. **目录管理**
   - 目录作为特殊文件
   - 目录项：name → inode number
   - 支持 `.` 与 `..`

4. **文件操作**
   - 创建、删除文件
   - 打开、关闭文件
   - 读取、写入文件内容
   - 基本目录操作（mkdir / ls / cd / pwd）

5. **文件系统状态管理**
   - inode 与数据块的分配与回收通过位图完成
   - 文件系统状态可持久化保存并恢复

---

## （四）设备管理模拟

### 实现内容

1. **设备抽象**
   - 设备表（设备名、占用状态）

2. **设备分配与回收**
   - 进程请求设备
   - 使用完毕后释放设备

3. **阻塞与唤醒**
   - 设备忙时进程阻塞
   - 设备完成后唤醒进程

---

## 五、系统交互与可观测性

- 提供命令行 Shell
- 支持展示：
  - 进程状态与调度结果
  - 页表与缺页统计
  - 文件系统结构
  - 设备占用情况
- 关键操作输出日志，便于分析与推演
